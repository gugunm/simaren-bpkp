"use strict";(self["webpackChunk_coreui_coreui_free_vue_admin_template"]=self["webpackChunk_coreui_coreui_free_vue_admin_template"]||[]).push([[129],{129:function(t,a,e){e.d(a,{Z:function(){return Q}});var i=e(3396),s=e(9242),o=e(7139);const l={key:0,class:"h4 mb-4"},p={key:1,class:"h4 mb-4"},d=(0,i.Uk)("ID "),n={class:"col-sm-2"},r=(0,i.Uk)("Tahun "),m=(0,i._)("span",{class:"text-red-500"},"*",-1),c={class:"col-sm-2"},u=(0,i.Uk)("Nama KAP "),h=(0,i._)("span",{class:"text-red-500"},"*",-1),k={class:"col-sm-9"},f=(0,i.Uk)("Unit Kerja PJ KAP "),g=(0,i._)("span",{class:"text-red-500"},"*",-1),w={class:"col-sm-9"},T={class:"flex col-sm-12"},_=(0,i.Uk)(" Tambah "),y={class:"flex flex-col"},b={class:"-my-2 sm:-mx-6 lg:-mx-8"},x={class:"py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8"},K={class:"shadow-sm border-b border-gray-200 sm:rounded-lg"},v={class:"w-full divide-y divide-gray-200"},U=(0,i._)("thead",{class:"bg-gray-50"},[(0,i._)("tr",null,[(0,i._)("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Nama Topik "),(0,i._)("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," PJ Topik "),(0,i._)("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Informasi Topik Yang Diharapkan "),(0,i._)("th",{scope:"col",class:"relative px-6 py-3"},[(0,i._)("span",{class:"sr-only"},"Hapus")])])],-1),W={class:"bg-white divide-y divide-gray-200"},D={key:0},C=(0,i._)("td",{colspan:"4"},[(0,i._)("div",{class:"py-3 text-center text-gray-700"}," Belum ada data ")],-1),S=[C],j={class:"px-6 py-2"},V={class:"text-sm text-gray-900"},$={class:"px-6 py-2 whitespace-nowrap"},R={class:"text-sm text-gray-900"},P={class:"px-6 py-2"},L={class:"text-sm break-normal text-gray-900"},E={class:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium"},O=["onClick"],F=(0,i.Uk)(" Batal "),I=(0,i.Uk)(" Reset "),A={key:0},B=(0,i.Uk)(" Simpan "),q={key:1};function z(t,a,e,C,z,H){const N=(0,i.up)("Loading"),Z=(0,i.up)("CFormLabel"),G=(0,i.up)("CFormInput"),J=(0,i.up)("CRow"),M=(0,i.up)("VueMultiselect"),Y=(0,i.up)("CButton"),Q=(0,i.up)("CCol"),X=(0,i.up)("CSpinner"),tt=(0,i.up)("CForm"),at=(0,i.up)("CCardBody"),et=(0,i.up)("CCard");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i.Wm)(N,{active:z.loading,"onUpdate:active":a[0]||(a[0]=t=>z.loading=t),"is-full-page":!0},null,8,["active"]),(0,i.Wm)(et,{class:"mb-4"},{default:(0,i.w5)((()=>[(0,i.Wm)(at,{class:"p-4"},{default:(0,i.w5)((()=>["create"==e.mode?((0,i.wg)(),(0,i.iD)("h4",l,"Tambah KAP")):"update"==e.mode?((0,i.wg)(),(0,i.iD)("h4",p,"Edit KAP")):(0,i.kq)("",!0),"update"==e.mode?((0,i.wg)(),(0,i.j4)(J,{key:2,class:"mb-3"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{for:"tahun",class:"col-sm-3 col-form-label"},{default:(0,i.w5)((()=>[d])),_:1}),(0,i._)("div",n,[(0,i.Wm)(G,{modelValue:z.editData.idKap,"onUpdate:modelValue":a[1]||(a[1]=t=>z.editData.idKap=t),readonly:""},null,8,["modelValue"])])])),_:1})):(0,i.kq)("",!0),(0,i.Wm)(tt,{onSubmit:(0,s.iM)(H.submit,["prevent"])},{default:(0,i.w5)((()=>[(0,i.Wm)(J,{class:"mb-3"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{for:"tahun",class:"col-sm-3 col-form-label"},{default:(0,i.w5)((()=>[r,m])),_:1}),(0,i._)("div",c,[(0,i.Wm)(G,{type:"number",id:"tahun",modelValue:z.form.tahun,"onUpdate:modelValue":a[2]||(a[2]=t=>z.form.tahun=t),readonly:"",required:""},null,8,["modelValue"])])])),_:1}),(0,i.Wm)(J,{class:"mb-3"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{for:"nama-kap",class:"col-sm-3 col-form-label"},{default:(0,i.w5)((()=>[u,h])),_:1}),(0,i._)("div",k,[(0,i.Wm)(G,{type:"text",id:"nama-kap",modelValue:z.form.namaKap,"onUpdate:modelValue":a[3]||(a[3]=t=>z.form.namaKap=t),required:""},null,8,["modelValue"])])])),_:1}),(0,i.Wm)(J,{class:"mb-4"},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{for:"pj-kap",class:"col-sm-3 col-form-label"},{default:(0,i.w5)((()=>[f,g])),_:1}),(0,i._)("div",w,[(0,i.Wm)(M,{id:"pj-kap",modelValue:z.selectedRendal,"onUpdate:modelValue":a[4]||(a[4]=t=>z.selectedRendal=t),options:z.optionsRendal,placeholder:"Pilih PJ KAP",label:"deskripsi","track-by":"deskripsi","custom-label":H.viewSelectSearch},null,8,["modelValue","options","custom-label"])])])),_:1}),(0,i.Wm)(J,{class:"mb-4 view-form"},{default:(0,i.w5)((()=>[(0,i._)("div",T,[(0,i.Wm)(M,{id:"nama-topik",modelValue:z.selectedTopik,"onUpdate:modelValue":a[5]||(a[5]=t=>z.selectedTopik=t),options:z.currentOptionsTopik,placeholder:"Pilih Topik",label:"namaTopik","track-by":"namaTopik",deselectLabel:"",selectLabel:""},null,8,["modelValue","options"]),(0,i.Wm)(Y,{type:"button",class:"ml-3 px-4 text-white",color:"success",size:"sm",onClick:a[6]||(a[6]=t=>H.addTopik(z.idTopik))},{default:(0,i.w5)((()=>[_])),_:1})])])),_:1}),(0,i._)("div",y,[(0,i._)("div",b,[(0,i._)("div",x,[(0,i._)("div",K,[(0,i._)("table",v,[U,(0,i._)("tbody",W,[0==z.topiks.length?((0,i.wg)(),(0,i.iD)("tr",D,S)):((0,i.wg)(!0),(0,i.iD)(i.HY,{key:1},(0,i.Ko)(z.topiks,(t=>((0,i.wg)(),(0,i.iD)("tr",{key:t.nama},[(0,i._)("td",j,[(0,i._)("div",V,(0,o.zw)(t.nama),1)]),(0,i._)("td",$,[(0,i._)("div",R,(0,o.zw)(t.pj),1)]),(0,i._)("td",P,[(0,i._)("p",L,(0,o.zw)(t.deskripsi),1)]),(0,i._)("td",E,[(0,i._)("button",{class:"text-red-600 hover:text-red-900",onClick:a=>H.hapusTopikLokal(t.idTopik)}," Hapus ",8,O)])])))),128))])])])])])]),(0,i.Wm)(J,{class:"mt-8 view-form"},{default:(0,i.w5)((()=>[(0,i.Wm)(Q,{sm:"12",lg:"6",class:"mb-3"},{default:(0,i.w5)((()=>["view"!=e.mode?((0,i.wg)(),(0,i.j4)(Y,{key:0,variant:"outline",color:"dark",onClick:a[7]||(a[7]=a=>t.$router.push("/kap")),class:"px-5"},{default:(0,i.w5)((()=>[F])),_:1})):(0,i.kq)("",!0)])),_:1}),"create"==e.mode||"update"==e.mode?((0,i.wg)(),(0,i.j4)(Q,{key:0,sm:"12",md:"6",class:"flex content-center justify-end pr-3 mb-3"},{default:(0,i.w5)((()=>[(0,i.Wm)(Y,{type:"button",class:"ml-1 px-5 text-white",color:"danger",onClick:H.reset},{default:(0,i.w5)((()=>[I])),_:1},8,["onClick"]),(0,i.Wm)(Y,{type:"submit",color:"info",class:"px-5 ml-2 text-white"},{default:(0,i.w5)((()=>[z.loading?((0,i.wg)(),(0,i.iD)("div",A,[(0,i.Wm)(X,{color:"white",size:"sm",class:"mr-2"}),B])):((0,i.wg)(),(0,i.iD)("p",q,"Simpan"))])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1},8,["onSubmit"])])),_:1})])),_:1})],64)}var H=e(6265),N=e.n(H),Z=e(6368),G=e(6216),J={components:{Loading:G.Z,VueMultiselect:Z.ZP},props:["mode","idKap"],data(){return{form:this.getEmptyForm(),submitted:!1,loading:!1,selectedRendal:null,optionsRendal:[],selectedTopik:null,idTopik:null,optionsTopik:[],currentOptionsTopik:[],editData:{},topiks:[]}},watch:{selectedRendal:function(t){t&&(this.form.idUnitKerjaKap=t.id)},selectedTopik:function(t){t&&(this.idTopik=t.idTopik)}},async mounted(){if(this.form.tahun=localStorage.tahun,this.optionsRendal=await this.$store.dispatch("loadListUnitKontributor"),"create"==this.mode)this.optionsTopik=await this.$store.dispatch("loadTopikKap"),this.currentOptionsTopik=this.optionsTopik;else if("update"==this.mode){this.loading=!0,this.optionsTopik=await this.$store.dispatch("loadTopikKapEdit"),await this.loadKapById();const t=this.optionsRendal.filter((t=>t.id==this.form.idUnitKerjaKap));this.selectedRendal=t[0],this.editData.idTopik.split(",").map((t=>Number(t))).forEach((t=>{this.addTopik(t)}))}},methods:{viewSelectSearch({alias:t,deskripsi:a}){return`${t} - ${a}`},addTopik(t){const a=this.optionsTopik.filter((a=>a.idTopik==t))[0],e={idTopik:a.idTopik,nama:a.namaTopik,pj:a.unitKerja,deskripsi:a.deskripsi};this.topiks.push(e),this.form.dataTopik.push(e.idTopik),this.currentOptionsTopik=this.optionsTopik.filter((t=>!this.form.dataTopik.includes(t.idTopik))),this.idTopik=null,this.selectedTopik=null},hapusTopikLokal(t){this.topiks=this.topiks.filter((a=>a.idTopik!=t));const a=this.form.dataTopik.indexOf(t);a>-1&&this.form.dataTopik.splice(a,1),this.currentOptionsTopik=this.optionsTopik.filter((t=>!this.form.dataTopik.includes(t.idTopik)))},async submit(){const t=this.$func.isNullOfObjElement(this.form);if(t&&0!=this.topiks.length){this.submitted=!0;const t=this.appendToFormData();try{if("create"==this.mode){this.loading=!0;const a=await N()({method:"POST",baseURL:this.$apiAddress,url:"/api/kap",data:t,params:{token:localStorage.getItem("token")}});200!=a.status?this.error="Gagal menyimpan data":(this.loading=!1,this.$router.push("/kap"),this.toastSuccess("Berhasil menyimpan data"))}else if("update"==this.mode){this.loading=!0;const a=await N()({method:"POST",baseURL:this.$apiAddress,url:`/api/kap/${this.idKap}`,data:t,params:{token:localStorage.getItem("token")}});200!=a.status?this.error="Gagal merubah data":(this.loading=!1,this.$router.push("/kap"),this.toastSuccess("Berhasil merubah data"))}}catch(a){setTimeout((()=>{this.loading=!1,this.toastError("Terjadi kesalahan saat submit data")}),500)}}else this.toastWarning("Lengkapi data sebelum submit!")},reset(){this.form=this.getEmptyForm(),this.submitted=!1,this.selectedRendal=null,this.currentOptionsTopik=this.optionsTopik,this.topiks=[]},getEmptyForm(){return{tahun:null,namaKap:null,idUnitKerjaKap:null,dataTopik:[]}},appendToFormData(){const t=new FormData;return"update"==this.mode&&t.append("_method","PUT"),t.append("tahun",this.form.tahun),t.append("namaKap",this.form.namaKap),t.append("idUnitKerjaKap",this.form.idUnitKerjaKap),t.append("idTopik",this.form.dataTopik.toString()),t.append("nip",localStorage.getItem("nip")),t},async loadKapById(){try{const t=await N()({method:"GET",baseURL:this.$apiAddress,url:`/api/kap/${this.idKap}`,params:{token:localStorage.getItem("token")}});this.editData=await t.data,200==t.status&&(this.form={tahun:this.editData.tahun,namaKap:this.editData.namaKap,idUnitKerjaKap:this.editData.idUnitKerjaKap,dataTopik:[]}),this.loading=!1}catch(t){this.toastError(t.message),this.loading=!1}},toastSuccess(t){this.$toast.open({message:t,type:"success",position:"top-right",duration:3e3})},toastError(t){this.$toast.open({message:t,type:"error",position:"top-right",duration:3e3})},toastWarning(t){this.$toast.open({message:t,type:"warning",position:"top-right",duration:3e3})}}},M=e(89);const Y=(0,M.Z)(J,[["render",z]]);var Q=Y}}]);
//# sourceMappingURL=129.1f23faae.js.map